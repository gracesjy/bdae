## S

```
CREATE TABLE MATRIX ( 
CONTEXT VARCHAR2(40),
ROW_ NUMBER,
COL_ NUMBER,
TABLE_NAME VARCHAR2(40),
COL_NAME VARCHAR2(40),
VAL VARCHAR2(40)
);

DROP TABLE MATRIX PURGE;

INSERT INTO MATRIX VALUES('TABLE_1', 1,1,'T1','A', '1_1');
INSERT INTO MATRIX VALUES('TABLE_1', 1,2,'T2','C', '1_2');
INSERT INTO MATRIX VALUES('TABLE_1', 1,3,'T3','B', '1_3');

INSERT INTO MATRIX VALUES('TABLE_1', 2,1,'T1','B', '2_1');
INSERT INTO MATRIX VALUES('TABLE_1', 2,2,'T2','D', '2_2');
INSERT INTO MATRIX VALUES('TABLE_1', 2,3,'T3','C', '2_3');

CREATE TABLE T1 (
CONTEXT VARCHAR2(40),
A VARCHAR2(40),
B VARCHAR2(40)
);

CREATE TABLE T2 ( 
CONTEXT VARCHAR2(40),
A  VARCHAR2(40),
B  VARCHAR2(40),
C  VARCHAR2(40),
D  VARCHAR2(40));

CREATE TABLE T3 ( 
CONTEXT VARCHAR2(40),
A  VARCHAR2(40),
B  VARCHAR2(40),
C  VARCHAR2(40),
D  VARCHAR2(40));

INSERT INTO T1 VALUES('TABLE_1', 'Label1','Label2');
INSERT INTO T2 VALUES('TABLE_1', 'Data1','Data2', 'Data3', 'Data4');
INSERT INTO T3 VALUES('TABLE_1', 'Data1_T3','Data2_T3', 'Data3_T3', 'Data4_T3');

SELECT Y.ROW_, Y.COL_, 
CASE 
 WHEN COL_NAME ='A' THEN X.A
 WHEN COL_NAME ='B' THEN X.B
END AS VAL
FROM MATRIX Y, T1 X
WHERE X.CONTEXT=Y.CONTEXT 
AND Y.TABLE_NAME='T1'
AND Y.CONTEXT ='TABLE_2'
UNION
SELECT X.ROW_X + 1, Y.COL_, 
CASE 
 WHEN COL_NAME ='A' THEN X.A
 WHEN COL_NAME ='B' THEN X.B
END AS VAL
FROM MATRIX Y, (SELECT ROWNUM AS ROW_X, A.* FROM T4 A WHERE CONTEXT='TABLE_2') X
WHERE X.CONTEXT=Y.CONTEXT 
AND Y.TABLE_NAME='T4';

-- 
SELECT * FROM ( 
SELECT Y.ROW_, Y.COL_, 
CASE 
 WHEN COL_NAME ='A' THEN X.A
 WHEN COL_NAME ='B' THEN X.B
END AS VAL
FROM MATRIX Y, T1 X
WHERE X.CONTEXT=Y.CONTEXT 
AND Y.TABLE_NAME='T1'
UNION
SELECT Y.ROW_, Y.COL_, 
CASE 
 WHEN COL_NAME ='C' THEN X.C
 WHEN COL_NAME ='D' THEN X.D
END AS VAL
FROM MATRIX Y, T2 X
WHERE X.CONTEXT=Y.CONTEXT 
AND Y.TABLE_NAME='T2'
UNION
SELECT Y.ROW_, Y.COL_, 
CASE 
 WHEN COL_NAME ='B' THEN X.B
 WHEN COL_NAME ='C' THEN X.C
END AS VAL
FROM MATRIX Y, T3 X
WHERE X.CONTEXT=Y.CONTEXT 
AND Y.TABLE_NAME='T3'
) ORDER BY ROW_;

SELECT Y.ROW_, Y.COL_, 
     CASE WHEN COL_NAME = 'A' THEN X.A
          WHEN COL_NAME = 'B' THEN X.B
     END AS VAL
FROM MATRIX Y, T1 X
WHERE Y.CONTEXT = X.CONTEXT
 AND Y.TABLE_NAME = 'T1'
UNION
SELECT Y.ROW_, Y.COL_, 
     CASE WHEN COL_NAME = 'C' THEN X.C
          WHEN COL_NAME = 'D' THEN X.D
     END AS VAL
FROM MATRIX Y, T2 X
WHERE Y.CONTEXT = X.CONTEXT
 AND Y.TABLE_NAME = 'T2';
 
 SELECT Y.ROW_, Y.COL_, 
     CASE WHEN COL_NAME = 'A' THEN X.A
          WHEN COL_NAME = 'B' THEN X.B
     END AS VAL
FROM MATRIX Y, T1 X
WHERE Y.CONTEXT = X.CONTEXT
 AND Y.TABLE_NAME = 'T1'
UNION
SELECT Y.ROW_, Y.COL_, 
     CASE WHEN COL_NAME = 'C' THEN X.C
          WHEN COL_NAME = 'D' THEN X.D
     END AS VAL
FROM MATRIX Y, T2 X
WHERE Y.CONTEXT = X.CONTEXT
 AND Y.TABLE_NAME = 'T2';

SELECT A.TABLE_NAME, A.COL_NAME FROM
MATRIX A, (SELECT DISTINCT TABLE_NAME FROM MATRIX) B 
WHERE A.TABLE_NAME = B.TABLE_NAME
ORDER BY TABLE_NAME;

SELECT 'CASE WHEN COL_NAME = ' ||  COL_NAME || ''' THEN T.' || COL_NAME
FROM MATRIX m 
WHERE TABLE_NAME = 'T1';


CREATE TABLE MATRIX_STRUCTURE ( 
CONTEXT VARCHAR2(40),
ROW_ NUMBER,
COL_ NUMBER,
MERGE_ VARCHAR2(40)
); 


INSERT INTO MATRIX_STRUCTURE VALUES('TABLE_1', 1, 1, 'H1');
INSERT INTO MATRIX_STRUCTURE VALUES('TABLE_1', 1, 2, 'H1');
INSERT INTO MATRIX_STRUCTURE VALUES('TABLE_1', 1, 3, 'H1');
INSERT INTO MATRIX_STRUCTURE VALUES('TABLE_1', 2, 1, '');
INSERT INTO MATRIX_STRUCTURE VALUES('TABLE_1', 2, 2, 'V1');
INSERT INTO MATRIX_STRUCTURE VALUES('TABLE_1', 2, 3, '');

INSERT INTO MATRIX_STRUCTURE VALUES('TABLE_1', 3, 1, '');
INSERT INTO MATRIX_STRUCTURE VALUES('TABLE_1', 3, 2, 'V1');
INSERT INTO MATRIX_STRUCTURE VALUES('TABLE_1', 3, 3, '');

SELECT MERGE_ AS MERGE_NAME, CASE WHEN SUBSTR(MERGE_, 1, 1) = 'H' THEN TO_CHAR(MIN_ROW) || ',' || TO_CHAR(MIN_COL) || ',' || TO_CHAR(MAX_COL) 
            WHEN SUBSTR(MERGE_, 1, 1) = 'V' THEN TO_CHAR(MIN_COL) || ',' || TO_CHAR(MIN_ROW) || ',' || TO_CHAR(MAX_ROW)
       END MERGE_INFO
FROM ( 
SELECT
	MERGE_,
	MIN(ROW_) MIN_ROW,
	MIN(COL_) MIN_COL,
	MAX(ROW_) MAX_ROW,
	MAX(COL_) MAX_COL
FROM
	MATRIX_STRUCTURE
WHERE
	MERGE_ IS NOT NULL
GROUP BY
	MERGE_
);

```